---
import { PUBLIC_PB_URL } from "astro:env/client";

import { pb } from "../../lib/pocketbase";
import { DateTime } from "luxon";

import Layout from "../../layouts/Layout.astro";

export async function getStaticPaths() {
  const records = await pb
    .collection("articles")
    .getFullList({ filter: "isActive=true" });

  if (records.length === 0) {
    return [];
  }

  return records.map((article) => ({
    params: { slug: article.slug },
    props: { article },
  }));
}

const { article } = Astro.props;
---

<Layout>
  <div class="mx-auto max-w-5xl p-6 pt-12">
    <div class="flex flex-col">
      <div
        class="flex flex-col items-center justify-between sm:flex-row sm:items-start"
      >
        <h1 class="w-full text-center text-3xl font-bold sm:text-left">
          {article.title}
        </h1>
        <p
          class="mt-2 w-full whitespace-nowrap text-center text-xs text-gray-500 sm:mt-0 sm:w-auto sm:text-right"
        >
          Publi√© le {
            DateTime.fromSQL(article.releaseDate)
              .setLocale("fr")
              .toFormat("dd MMMM yyyy")
          }
        </p>
      </div>
      <div class="mt-6">
        {
          article.images.length > 0 && (
            <img
              src={`${PUBLIC_PB_URL}/api/files/articles/${article.id}/${article.images[0]}`}
              alt={article.imgDescription}
              class="float-left mb-6 mr-6 w-full rounded-sm sm:w-1/3"
              loading="lazy"
            />
          )
        }
        <article
          class="prose max-w-none text-justify"
          set:html={article.content}
        />
      </div>
    </div>
    {
      article.extra && (
        <div class="bg-madRed text-madBack md:mt-22 mt-10 rounded-xl p-4">
          <article set:html={article.extra} />
        </div>
      )
    }
  </div>
</Layout>
