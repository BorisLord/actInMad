---
import Layout from '../../layouts/Layout.astro';
import PocketBase from 'pocketbase';
import { API_URL } from 'astro:env/client';
import { DateTime } from 'luxon';

export async function getStaticPaths() {
  const pb = new PocketBase(API_URL);
  const records = await pb
    .collection('articles')
    .getFullList({ filter: 'isActive=true' });

  if (records.length === 0) {
    return [];
  }

  return records.map((article) => ({
    params: { slug: article.slug },
    props: { article },
  }));
}

const { article } = Astro.props;
---

<Layout>
  <div class="max-w-3xl mx-auto p-4 pt-12">
    <div class="flex flex-col sm:flex-row justify-between">
      <div>
        <h1 class="text-3xl font-bold">{article.title}</h1>
      </div>
      <div class="text-left sm:text-right text-xs text-gray-500 mt-2 sm:mt-0">
        <p>
          Publié le {
            DateTime.fromSQL(article.releaseDate)
              .setLocale('fr')
              .toFormat('dd MMMM yyyy')
          }
        </p>
        <p class="text-gray-500 italic mt-1">
          Écrit par {article.writter || 'Auteur anonyme'}
        </p>
      </div>
    </div>
    {
      article.images.length > 0 && (
        <img
          src={`${API_URL}/api/files/articles/${article.id}/${article.images[0]}`}
          alt={article.Title}
          class="w-full h-72 object-cover mt-4 rounded-md"
        />
      )
    }
    <article
      class="prose max-w-none mt-8 mb-20 text-justify"
      set:html={article.content}
    />
  </div>
</Layout>
